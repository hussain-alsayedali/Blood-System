// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model nurse {
  nurseId          Int                @id @default(autoincrement())
  bankId           String             @unique
  createdAt        DateTime           @default(now())
  email            String             @unique @db.VarChar(255)
  phone            String             @unique
  weight           Float
  birth            DateTime
  address          String
  firstName        String
  lastName         String
  password         String
  DonationRequest  DonationRequest[]
  ReceivingRequest ReceivingRequest[]
}

model Recipient {
  recipientId      Int                @id @default(autoincrement())
  currentUrgency   String
  bankId           String             @unique
  currentMoney     Int                @default(0)
  createdAt        DateTime           @default(now())
  email            String             @unique @db.VarChar(255)
  phone            String             @unique
  weight           Float
  birth            DateTime
  address          String
  firstName        String
  lastName         String
  password         String
  infections       infection[]
  blood            Blood              @relation(fields: [bloodType], references: [type])
  bloodType        String
  BloodBag         BloodBag[]
  ReceivingRequest ReceivingRequest[]
}

model Donor {
  donorId         Int               @id @default(autoincrement())
  currentMoney    Int               @default(0)
  bankId          String            @unique
  createdAt       DateTime          @default(now())
  email           String            @unique @db.VarChar(255)
  phone           String            @unique
  weight          Float
  birth           DateTime
  address         String
  firstName       String
  lastName        String
  password        String
  diseases        infection[]
  blood           Blood             @relation(fields: [bloodType], references: [type])
  bloodType       String
  BloodBag        BloodBag[]
  DonationRequest DonationRequest[]
}

model infection {
  infectionId             Int            @id @default(autoincrement())
  diseaseName             DiseaseCatalog @relation(fields: [diseaseCatalogDiseaseId], references: [diseaseId])
  dateOfInfection         DateTime
  dateOfheal              DateTime?
  strength                String
  cured                   Boolean
  Recipient               Recipient?     @relation(fields: [recipientRecipientId], references: [recipientId])
  recipientRecipientId    Int?
  Donor                   Donor?         @relation(fields: [donorDonorId], references: [donorId])
  donorDonorId            Int?
  diseaseCatalogDiseaseId Int
}

model DiseaseCatalog {
  diseaseId   Int         @id @default(autoincrement())
  diseaseName String
  infection   infection[]
}

model Blood {
  type        String      @id @unique
  recieveFrom String
  Donor       Donor[]
  Recipient   Recipient[]
}

model BloodBag {
  bagId            Int                @id @default(autoincrement())
  takingDate       DateTime           @default(now())
  givenTo          Recipient?         @relation(fields: [recipientId], references: [recipientId])
  recipientId      Int?
  recipientDate    DateTime?
  Donor            Donor?             @relation(fields: [donorId], references: [donorId])
  donorId          Int?
  donationId       Int                @unique
  BloodBank        BloodBank?         @relation(fields: [bloodBankId], references: [bloodBankId])
  bloodBankId      Int?
  DonationRequest  DonationRequest[]
  ReceivingRequest ReceivingRequest[]
}

model DonationRequest {
  id              Int       @id @unique @default(autoincrement())
  requestDate     DateTime  @default(now())
  donor           Donor     @relation(fields: [donorId], references: [donorId])
  donorId         Int
  bloodBag        BloodBag? @relation(fields: [bloodBagId], references: [bagId])
  bloodBagId      Int?
  operationStatus String?
  requestStatus   String?   @default("waiting")
  updateDate      DateTime?
  nurse           nurse?    @relation(fields: [nurseId], references: [nurseId])
  nurseId         Int?
}

model ReceivingRequest {
  id              Int       @id @unique @default(autoincrement())
  requestDate     DateTime  @default(now())
  recipient       Recipient @relation(fields: [recipientId], references: [recipientId])
  recipientId     Int
  bloodBagId      Int?
  updateDate      DateTime?
  bloodBag        BloodBag? @relation(fields: [bloodBagId], references: [bagId])
  operationStatus String?
  requestStatus   String?   @default("waiting")
  nurse           nurse?    @relation(fields: [nurseId], references: [nurseId])
  nurseId         Int?
}

model BloodBank {
  bloodBankId Int        @id @default(autoincrement())
  bloodBags   BloodBag[]
}

model Session {
  id        String   @id
  sid       String   @unique
  data      String
  expiresAt DateTime
}
